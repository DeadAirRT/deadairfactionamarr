<?xml version="1.0" encoding="utf-8"?>
<mdscript name="GS_DAM_Adv" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="md.xsd">
  <cues>
    <cue name="Start" namespace="this" module="x4ep1_gamestart_dam_adv">
      <conditions>
        <event_cue_signalled cue="md.Setup.GameStart" />
      </conditions>
      <actions>
        <debug_text text="'Starting DAM scientific gamestart'"/>
      </actions>
      <cues>

        <cue name="SetupHQ">
          <actions>
            <find_sector name="$HQSector" macro="macro.cluster_dam5_sector001_macro" required="true"/>
            <find_station name="$HQ" space="$HQSector" owner="faction.player" multiple="false" required="true"/>
          </actions>
          <cues>
            <cue name="SetupManager" onfail="cancel">
              <conditions>
                <check_value value="$HQ"/>
              </conditions>
              <delay exact="1s"/>
              <actions>
                <create_control_entity object="$HQ" post="controlpost.manager">
                  <select tags="controlpost.manager.tag" faction="faction.player"/>
                  <owner exact="$HQ.owner"/>
                </create_control_entity>
              </actions>
            </cue>
          </cues>
        </cue>
        <cue name="SetupMap">
          <actions>
            <!-- set part of the map to known, ring + dam -->
            <set_value name="$AllSectors" exact="[]" />
			<set_value name="$InitialMap" exact="[]"/>
			<find_sector name="$AllSectors" space="player.galaxy" multiple="true" />
			<do_for_each name="$Sector" in="$AllSectors">
				<append_to_list name="$InitialMap" exact="$Sector.macro"/>
				<do_if value="[faction.damarr,faction.daldari,faction.paranid].indexof.{$Sector.owner}">
					<get_safe_pos result="$Position" sector="$Sector" radius="25km" value="position.[1, 1, 1]" allowyaxis="false" />
					<create_object macro="macro.eq_arg_satellite_02_macro" owner="faction.player" sector="$Sector">
						<safepos position="$Position"/>
					</create_object>
				</do_if>
			</do_for_each>
            <run_actions ref="md.LIB_Generic.UncoverMap_SectorsAndGates_Call" >
              <param name="InitialMap" value="$InitialMap"/>
              <param name="UncoverShipyardsAndWharfs" value="true"/>
              <param name="UncoverTradeStations" value="true"/>
            </run_actions>
          </actions>
        </cue>
      </cues>
    </cue>    
  </cues>
</mdscript>
